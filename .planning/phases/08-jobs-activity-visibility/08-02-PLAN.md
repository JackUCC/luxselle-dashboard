---
phase: 08-jobs-activity-visibility
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/routeMeta.ts
  - src/components/layout/AnimatedRoutes.tsx
  - src/pages/Dashboard/DashboardView.tsx
autonomous: true
requirements: [OPS-02, DATA-03]
gap_closure: true

must_haves:
  truths:
    - "Navigating to /jobs in the browser renders JobsView without a blank page or error"
    - "DockBar and MobileNavDrawer show a Jobs nav entry derived from appRoutes[]"
    - "Dashboard overview page (non-sidecar) shows a Recent Activity section with events from GET /api/dashboard/activity"
    - "Activity section is not rendered in sidecar mode (DashboardView returns SidecarView early)"
  artifacts:
    - path: "src/components/layout/routeMeta.ts"
      provides: "/jobs entry in appRoutes[]"
      contains: "path: '/jobs'"
    - path: "src/components/layout/AnimatedRoutes.tsx"
      provides: "Lazy-loaded JobsView route at /jobs"
      contains: "JobsView"
    - path: "src/pages/Dashboard/DashboardView.tsx"
      provides: "Activity feed section below bento rows"
      contains: "dashboard/activity"
  key_links:
    - from: "src/components/layout/routeMeta.ts"
      to: "DockBar.tsx + MobileNavDrawer.tsx"
      via: "appRoutes array — both nav components filter from it automatically"
      pattern: "appRoutes.*section.*manage"
    - from: "src/components/layout/AnimatedRoutes.tsx"
      to: "src/pages/Jobs/JobsView.tsx"
      via: "lazy(() => import) + useRoutes"
      pattern: "lazy.*JobsView"
    - from: "src/pages/Dashboard/DashboardView.tsx"
      to: "/api/dashboard/activity"
      via: "apiGet in loadData() Promise.all"
      pattern: "apiGet.*dashboard/activity"
---

<objective>
Wire the already-complete JobsView into the app routing and navigation system, and surface the already-complete activity endpoint in DashboardView.

Purpose: Both the Jobs UI component and the activity API endpoint exist and work — they are simply not connected to the app shell. This plan makes them reachable and visible without writing any new logic.
Output: /jobs is navigable via nav and URL; activity feed renders on the overview dashboard.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<interfaces>
<!-- Exact current state of files being modified. Executor must match these patterns exactly. -->

Current routeMeta.ts appRoutes[] (src/components/layout/routeMeta.ts):
```typescript
import {
  Bookmark, Box, CircleDollarSign, Globe, House, Receipt,
  ScanLine, Tags, TrendingUp, type LucideIcon,
} from 'lucide-react'

export const appRoutes: RouteMeta[] = [
  { path: '/', label: 'Overview', navLabel: 'Overview', icon: House, section: 'check' },
  { path: '/buy-box', label: 'Price Check', navLabel: 'Price Check', icon: CircleDollarSign, section: 'check' },
  { path: '/retail-price', label: 'Retail Price', navLabel: 'Retail Price', icon: Tags, section: 'check' },
  { path: '/serial-check', label: 'Serial Check', navLabel: 'Serial Check', icon: ScanLine, section: 'check' },
  { path: '/market-research', label: 'Market Research', navLabel: 'Market Research', icon: TrendingUp, section: 'check' },
  { path: '/saved-research', label: 'Saved Research', navLabel: 'Saved Research', icon: Bookmark, section: 'check' },
  { path: '/inventory', label: 'Inventory', navLabel: 'Inventory', icon: Box, section: 'manage' },
  { path: '/sourcing', label: 'Sourcing', navLabel: 'Sourcing', icon: Globe, section: 'manage' },
  { path: '/invoices', label: 'Invoices', navLabel: 'Invoices', icon: Receipt, section: 'manage' },
  // /jobs is MISSING — add it here as the last 'manage' entry
]
```

Current AnimatedRoutes.tsx lazy imports (src/components/layout/AnimatedRoutes.tsx):
```typescript
const DashboardView = lazy(() => import('../../pages/Dashboard/DashboardView'))
const InventoryView = lazy(() => import('../../pages/Inventory/InventoryView'))
const EvaluatorView = lazy(() => import('../../pages/BuyBox/EvaluatorView'))
const SourcingView = lazy(() => import('../../pages/Sourcing/SourcingView'))
const InvoicesView = lazy(() => import('../../pages/Invoices/InvoicesView'))
// ... (other views)
// JobsView is MISSING — add lazy import and route entry

const routes = [
  { path: '/', element: <DashboardView /> },
  // ... (existing routes)
  { path: '/invoices', element: <InvoicesView /> },
  { path: '/evaluator', element: <Navigate to="/buy-box" replace /> },
  // /jobs route is MISSING — add before the /evaluator redirect
]
```

Current DashboardView.tsx data fetch (src/pages/Dashboard/DashboardView.tsx):
```typescript
// Existing loadData:
const [kpisRes, profitRes] = await Promise.all([
  apiGet<{ data: KPIs }>('/dashboard/kpis'),
  apiGet<{ data: ProfitSummary }>('/dashboard/profit-summary'),
])
setKpis(kpisRes.data)
setProfit(profitRes.data ?? null)

// Activity state is MISSING — add:
// const [activities, setActivities] = useState<ActivityEvent[]>([])
// Extend Promise.all to fetch '/dashboard/activity?limit=10'
// setActivities(activityRes.data ?? [])

// Activity section in JSX is MISSING — add after Row 4 BentoGrid
```

ActivityEvent type (packages/shared/src/schemas/activityEvent.ts):
```typescript
type ActivityEvent = {
  organisationId: string
  createdAt: string
  updatedAt: string
  actor: string
  eventType: string
  entityType: string
  entityId: string
  payload: Record<string, any>
}
// Import: import type { ActivityEvent } from '@luxselle/shared'
```

SectionLabel component: exported from '../../components/design-system' — already imported by other DashboardView widgets.
</interfaces>

<tasks>

<task type="auto">
  <name>Task 1: Register /jobs in routeMeta.ts and AnimatedRoutes.tsx</name>
  <files>src/components/layout/routeMeta.ts, src/components/layout/AnimatedRoutes.tsx</files>
  <action>
    TWO edits — both files, no changes to DockBar.tsx or MobileNavDrawer.tsx.

    **Edit 1 — src/components/layout/routeMeta.ts:**
    Add `Briefcase` to the lucide-react import line (it is available — confirmed). Add the /jobs route as the last entry in the appRoutes[] array in the 'manage' section:
    ```typescript
    { path: '/jobs', label: 'Jobs', navLabel: 'Jobs', icon: Briefcase, section: 'manage' },
    ```
    Place it after the `/invoices` entry. The complete import line becomes:
    ```typescript
    import {
      Bookmark, Box, Briefcase, CircleDollarSign, Globe, House, Receipt,
      ScanLine, Tags, TrendingUp, type LucideIcon,
    } from 'lucide-react'
    ```
    No other changes to routeMeta.ts.

    **Edit 2 — src/components/layout/AnimatedRoutes.tsx:**
    Add the lazy import for JobsView alongside the other lazy imports at the top:
    ```typescript
    const JobsView = lazy(() => import('../../pages/Jobs/JobsView'))
    ```
    Add the route to the routes array. Insert it before the /evaluator redirect entry:
    ```typescript
    { path: '/jobs', element: <JobsView /> },
    ```
    No other changes to AnimatedRoutes.tsx — the existing Suspense/AnimatePresence wrappers in LuxselleApp cover all routes.

    Do NOT edit DockBar.tsx, MobileNavDrawer.tsx, or LuxselleApp.tsx. The nav components derive from appRoutes[] automatically.
  </action>
  <verify>
    <automated>cd /Users/jackkelleher/luxselle-dashboard && npm run typecheck 2>&1 | grep -E "error|warning|routeMeta|AnimatedRoutes" | head -20</automated>
  </verify>
  <done>
    TypeScript reports no errors for routeMeta.ts or AnimatedRoutes.tsx. appRoutes[] contains a /jobs entry with section: 'manage'. JobsView lazy import is present in AnimatedRoutes.tsx.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add activity feed fetch and section to DashboardView.tsx</name>
  <files>src/pages/Dashboard/DashboardView.tsx</files>
  <action>
    Edit src/pages/Dashboard/DashboardView.tsx. Three surgical changes:

    **Change 1 — import:** Add ActivityEvent type import. The shared package is @luxselle/shared. Add to the existing imports:
    ```typescript
    import type { ActivityEvent } from '@luxselle/shared'
    ```

    **Change 2 — state + fetch:** Add activities state. After the existing `const [error, setError] = useState<string | null>(null)` line, add:
    ```typescript
    const [activities, setActivities] = useState<ActivityEvent[]>([])
    ```
    Inside loadData(), extend the existing Promise.all to fetch activity data:
    ```typescript
    const [kpisRes, profitRes, activityRes] = await Promise.all([
      apiGet<{ data: KPIs }>('/dashboard/kpis'),
      apiGet<{ data: ProfitSummary }>('/dashboard/profit-summary'),
      apiGet<{ data: ActivityEvent[] }>('/dashboard/activity?limit=10'),
    ])
    setKpis(kpisRes.data)
    setProfit(profitRes.data ?? null)
    setActivities(activityRes.data ?? [])
    ```
    The catch block already handles errors generically — no change needed there.

    **Change 3 — JSX section:** After the closing tag of the Row 4 BentoGrid (the AiMarketPulseWidget row), add a Recent Activity section. The section only renders in non-sidecar mode because DashboardView already returns `<SidecarView />` early when isSidecar is true (line 58-60) — no extra guard needed.

    Add this after the `</BentoGrid>` closing tag of Row 4:
    ```tsx
    {/* Recent Activity */}
    {activities.length > 0 && (
      <div className="lux-card p-5 space-y-3" data-testid="activity-feed">
        <SectionLabel as="h2">Recent Activity</SectionLabel>
        <ul className="space-y-2">
          {activities.map((event) => (
            <li
              key={`${event.createdAt}-${event.entityId}`}
              className="flex items-start gap-3 text-sm text-lux-700"
            >
              <span className="shrink-0 rounded-full bg-lux-100 px-2 py-0.5 text-[11px] font-medium text-lux-500 uppercase tracking-wide">
                {event.eventType.replace(/_/g, ' ')}
              </span>
              <span className="text-lux-500 text-xs mt-0.5">
                {new Date(event.createdAt).toLocaleDateString(undefined, {
                  month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit',
                })}
              </span>
            </li>
          ))}
        </ul>
      </div>
    )}
    ```

    The `SectionLabel` component is already available — add it to the existing design-system import line which already imports `AnimatedNumber, BentoGrid, Button, PageHeader, StatCard`. Add `SectionLabel` to that destructure:
    ```typescript
    import { AnimatedNumber, BentoGrid, Button, PageHeader, SectionLabel, StatCard } from '../../components/design-system'
    ```

    Use `key={`${event.createdAt}-${event.entityId}`}` for React keys to avoid duplicate-key warnings when multiple events reference the same entity. Per research findings: BaseDocSchema does not include an id field, so the composite key is the safe approach.

    The section is wrapped in `{activities.length > 0 && ...}` so it does not render an empty card when no activity exists.
  </action>
  <verify>
    <automated>cd /Users/jackkelleher/luxselle-dashboard && npm run typecheck 2>&1 | grep -E "error|DashboardView" | head -20</automated>
  </verify>
  <done>
    TypeScript reports no errors for DashboardView.tsx. The file contains: ActivityEvent import, activities useState, extended Promise.all with /dashboard/activity, and a data-testid="activity-feed" section in the JSX.
  </done>
</task>

</tasks>

<verification>
Run typecheck to confirm no TypeScript errors:
```bash
cd /Users/jackkelleher/luxselle-dashboard && npm run typecheck 2>&1 | tail -10
```

Run unit tests to confirm no regressions:
```bash
cd /Users/jackkelleher/luxselle-dashboard && npm test 2>&1 | tail -10
```
</verification>

<success_criteria>
- npm run typecheck exits 0 with no errors
- npm test exits 0 with all tests passing
- routeMeta.ts appRoutes[] contains { path: '/jobs', section: 'manage' }
- AnimatedRoutes.tsx contains lazy JobsView import and /jobs route entry
- DashboardView.tsx fetches /dashboard/activity and renders data-testid="activity-feed" section
</success_criteria>

<output>
After completion, create `.planning/phases/08-jobs-activity-visibility/08-02-SUMMARY.md`
</output>
