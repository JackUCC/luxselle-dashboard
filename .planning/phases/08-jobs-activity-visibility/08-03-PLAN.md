---
phase: 08-jobs-activity-visibility
plan: 03
type: execute
wave: 2
depends_on: [08-02]
files_modified:
  - tests/e2e/dashboard-shell.spec.ts
autonomous: true
requirements: [OPS-02, DATA-03]
gap_closure: true

must_haves:
  truths:
    - "Playwright test confirms /jobs is reachable via dock-bar navigation on wide screens"
    - "Playwright test confirms /jobs is reachable via mobile-nav-drawer on narrow screens"
    - "Playwright test confirms activity-feed section is visible on the dashboard overview page"
  artifacts:
    - path: "tests/e2e/dashboard-shell.spec.ts"
      provides: "E2E coverage for /jobs navigation and activity feed"
      contains: "'/jobs'"
  key_links:
    - from: "tests/e2e/dashboard-shell.spec.ts"
      to: "src/components/layout/routeMeta.ts"
      via: "Playwright navigates app shell; DockBar and MobileNavDrawer render from appRoutes[]"
      pattern: "getByRole.*link.*Jobs"
    - from: "tests/e2e/dashboard-shell.spec.ts"
      to: "src/pages/Dashboard/DashboardView.tsx"
      via: "page.route mocks /api/dashboard/* responses; activity-feed testid is asserted"
      pattern: "activity-feed"
---

<objective>
Add E2E tests to confirm the two wiring changes from Plan 02 are observable in the running app: /jobs is navigable from both dock and mobile nav, and the activity feed renders on the dashboard.

Purpose: Unit tests in Plan 01 cover backend endpoints. These E2E tests confirm the UI wiring (routing, nav registration, frontend fetch + render) works end-to-end. Depends on Plan 02 having registered the /jobs route and added the activity section.
Output: Three new Playwright test cases in dashboard-shell.spec.ts, all passing.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<interfaces>
<!-- Exact current state of dashboard-shell.spec.ts — executor appends to this file. -->

Existing test structure (tests/e2e/dashboard-shell.spec.ts):
```typescript
import { test, expect, type APIRequestContext } from '@playwright/test'

const projectId = '[REDACTED]'
const emulatorBaseUrl = 'http://127.0.0.1:8082'

const clearFirestore = async (request: APIRequestContext) => { /* ... */ }

test.beforeEach(async ({ request }) => { await clearFirestore(request) })
test.afterEach(async ({ request }) => { await clearFirestore(request) })

test('mobile nav drawer opens and routes correctly', ...)       // existing
test('navigation drawer is used below xl and dock is hidden', ...)  // existing
test('dock bar is visible and routes correctly on wide screens', ...)  // existing
test('breadcrumb is hidden on base route and visible on deep state', ...)  // existing
test('dashboard skeleton appears during delayed load and then resolves', ...)  // existing
test('inventory missing-info filter works via URL', ...)         // existing
```

Established patterns from existing tests:
- Dock nav (wide): `page.setViewportSize({ width: 1720, height: 1000 })` + `page.getByTestId('dock-bar').getByRole('link', { name: 'X' }).click()`
- Mobile nav (narrow): `page.setViewportSize({ width: 390, height: 844 })` + `page.getByTestId('mobile-nav-toggle').click()` + `page.getByTestId('mobile-nav-drawer').getByRole('link', { name: 'X' }).click()`
- Route mock: `page.route('**/api/dashboard/kpis', async (route) => route.fulfill({ ... }))`
- testid: `data-testid="activity-feed"` is placed in DashboardView.tsx by Plan 02

JobsView page heading: JobsView uses PageLayout — check what heading text it renders. The research says `PageLayout variant="default"`. Verify the heading by navigating to /jobs and asserting the URL changed, not a specific heading text (safer against unknown heading).
</interfaces>

<tasks>

<task type="auto" tdd="true">
  <name>Task 1: Add /jobs navigation E2E tests and activity feed test</name>
  <files>tests/e2e/dashboard-shell.spec.ts</files>
  <behavior>
    - Test A: On wide screen (1720px), dock-bar has a 'Jobs' link that navigates to /jobs
    - Test B: On narrow screen (390px), mobile-nav-drawer has a 'Jobs' link that navigates to /jobs
    - Test C: On dashboard overview (non-sidecar), activity-feed section is visible when API returns events
  </behavior>
  <action>
    Append three new test cases to tests/e2e/dashboard-shell.spec.ts. Do NOT modify existing tests.

    **Test A — dock nav to /jobs (wide screen):**
    ```typescript
    test('dock bar navigates to /jobs', async ({ page }) => {
      await page.setViewportSize({ width: 1720, height: 1000 })
      await page.goto('/')

      const dock = page.getByTestId('dock-bar')
      await expect(dock).toBeVisible()

      await dock.getByRole('link', { name: 'Jobs' }).click()
      await expect(page).toHaveURL('/jobs')
    })
    ```

    **Test B — mobile nav to /jobs (narrow screen):**
    ```typescript
    test('mobile nav drawer navigates to /jobs', async ({ page }) => {
      await page.setViewportSize({ width: 390, height: 844 })
      await page.goto('/')

      await page.getByTestId('mobile-nav-toggle').click()
      await expect(page.getByTestId('mobile-nav-drawer')).toBeVisible()

      await page.getByTestId('mobile-nav-drawer').getByRole('link', { name: 'Jobs' }).click()
      await expect(page).toHaveURL('/jobs')
    })
    ```

    **Test C — activity feed visible on dashboard:**
    Mock all three dashboard API calls so the dashboard loads completely and shows the activity section. Use the same page.route pattern as the existing skeleton test.
    ```typescript
    test('activity feed is visible on dashboard overview', async ({ page }) => {
      await page.route('**/api/dashboard/kpis', async (route) => {
        await route.fulfill({
          status: 200,
          contentType: 'application/json',
          body: JSON.stringify({
            data: {
              totalInventoryValue: 0,
              totalInventoryPotentialValue: 0,
              totalInventoryItems: 0,
              activeSourcingPipeline: 0,
            },
          }),
        })
      })
      await page.route('**/api/dashboard/profit-summary', async (route) => {
        await route.fulfill({
          status: 200,
          contentType: 'application/json',
          body: JSON.stringify({ data: { totalCost: 0, totalRevenue: 0, totalProfit: 0, soldItems: 0 } }),
        })
      })
      await page.route('**/api/dashboard/activity', async (route) => {
        await route.fulfill({
          status: 200,
          contentType: 'application/json',
          body: JSON.stringify({
            data: [
              {
                organisationId: 'default',
                createdAt: '2026-03-01T10:00:00Z',
                updatedAt: '2026-03-01T10:00:00Z',
                actor: 'system',
                eventType: 'import_completed',
                entityType: 'supplier',
                entityId: 'sup-1',
                payload: {},
              },
            ],
          }),
        })
      })

      await page.goto('/')

      await expect(page.getByTestId('dashboard-skeleton')).toBeHidden()
      await expect(page.getByTestId('activity-feed')).toBeVisible()
    })
    ```

    The activity-feed testid is added to DashboardView.tsx by Plan 02. The dashboard-skeleton testid already exists in existing tests (DashboardSkeleton component). Mock profit-summary to avoid unhandled network errors — if the existing test approach only mocked kpis and let profit-summary fall through, profit-summary may 500 in CI. Safe to mock all three.
  </action>
  <verify>
    <automated>cd /Users/jackkelleher/luxselle-dashboard && npm run test:e2e -- --grep "navigates to /jobs|activity feed" 2>&1 | tail -20</automated>
  </verify>
  <done>
    All three new E2E tests pass. Existing E2E tests are not broken. npm run test:e2e exits 0.
  </done>
</task>

</tasks>

<verification>
Run full E2E suite:
```bash
cd /Users/jackkelleher/luxselle-dashboard && npm run test:e2e 2>&1 | tail -20
```

Confirm three new tests pass alongside all existing tests.
</verification>

<success_criteria>
- "dock bar navigates to /jobs" passes: URL becomes /jobs after clicking Jobs in dock
- "mobile nav drawer navigates to /jobs" passes: URL becomes /jobs after clicking Jobs in drawer
- "activity feed is visible on dashboard overview" passes: data-testid="activity-feed" is visible after mocked API response
- All pre-existing E2E tests continue to pass
- npm run test:e2e exits 0
</success_criteria>

<output>
After completion, create `.planning/phases/08-jobs-activity-visibility/08-03-SUMMARY.md`
</output>
