---
phase: 11-intel-02-agentic-market-intelligence
plan: 03
type: execute
wave: 3
depends_on:
  - "11-01"
  - "11-02"
files_modified:
  - src/pages/MarketResearch/MarketResearchView.tsx
  - src/pages/MarketResearch/MarketResearchResultPanel.tsx
  - src/pages/MarketResearch/types.ts
  - src/components/widgets/AiMarketPulseWidget.tsx
  - src/components/widgets/MarketIntelligenceWidget.tsx
  - tests/e2e/market-research.spec.ts
  - tests/e2e/dashboard-shell.spec.ts
autonomous: true
requirements: [INTEL-02]
must_haves:
  truths:
    - "Market Research UI distinguishes live vs cached results with explicit freshness labels."
    - "Users can trigger deep-dive from the UI and see execution status and completion metadata."
    - "Dashboard intelligence widgets show cache age/status rather than implying everything is live."
  artifacts:
    - path: "src/pages/MarketResearch/MarketResearchView.tsx"
      provides: "Deep-dive trigger and freshness state rendering"
      contains: "deepDive"
    - path: "src/components/widgets/AiMarketPulseWidget.tsx"
      provides: "Trending freshness badge and stale-state copy"
      contains: "cached"
    - path: "tests/e2e/market-research.spec.ts"
      provides: "E2E coverage for deep-dive/freshness rendering"
      contains: "deep-dive"
  key_links:
    - from: "MarketResearchView"
      to: "POST /api/market-research/deep-dive"
      via: "apiPost request and result mapping"
      pattern: "market-research/deep-dive"
    - from: "snapshot metadata"
      to: "freshness UI badge"
      via: "generatedAt + freshnessStatus"
      pattern: "freshness"
---

<objective>
Integrate Phase 11 backend intelligence into user-facing workflows with explicit live/cached indicators and deep-dive controls.

Purpose: INTEL-02 is not complete until operators can see and act on cache freshness in the main UI.
Output: Updated Market Research and dashboard intelligence UI + E2E parity coverage.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-intel-02-agentic-market-intelligence/11-01-SUMMARY.md
@.planning/phases/11-intel-02-agentic-market-intelligence/11-02-SUMMARY.md
@src/pages/MarketResearch/MarketResearchView.tsx
@src/components/widgets/AiMarketPulseWidget.tsx
@tests/e2e/market-research.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add freshness and deep-dive execution states in Market Research view</name>
  <files>src/pages/MarketResearch/MarketResearchView.tsx, src/pages/MarketResearch/types.ts, src/pages/MarketResearch/MarketResearchResultPanel.tsx</files>
  <action>Add live/cached badges, last-updated labels, deep-dive CTA, in-flight state, and response mapping for deep-dive metadata while preserving existing standard analyse flow.</action>
  <verify>npm run typecheck</verify>
  <done>MarketResearchView displays freshness context and deep-dive controls without regressions to existing standard analysis UX.</done>
</task>

<task type="auto">
  <name>Task 2: Surface cache status in dashboard intelligence widgets</name>
  <files>src/components/widgets/AiMarketPulseWidget.tsx, src/components/widgets/MarketIntelligenceWidget.tsx</files>
  <action>Expose snapshot freshness indicators and stale-state copy so dashboard intelligence no longer implies all data is always live.</action>
  <verify>npm run typecheck</verify>
  <done>Widgets show clear freshness metadata and handle stale/unavailable states gracefully.</done>
</task>

<task type="auto">
  <name>Task 3: Extend E2E coverage for deep-dive and freshness indicators</name>
  <files>tests/e2e/market-research.spec.ts, tests/e2e/dashboard-shell.spec.ts</files>
  <action>Add E2E tests for deep-dive trigger path and UI badge rendering for cached/live states using route stubs where appropriate.</action>
  <verify>npm run test:e2e -- market-research.spec.ts dashboard-shell.spec.ts</verify>
  <done>E2E suites validate deep-dive UI behavior and freshness rendering with stable assertions.</done>
</task>

</tasks>

<verification>
- [ ] `npm run typecheck`
- [ ] `npm run test:e2e -- market-research.spec.ts dashboard-shell.spec.ts`
</verification>

<success_criteria>
- Live vs cached status is visible in Market Research and dashboard intelligence surfaces.
- Deep-dive can be triggered and tracked from UI.
- E2E coverage protects the new interaction and status display paths.
</success_criteria>

<output>
After completion, create `.planning/phases/11-intel-02-agentic-market-intelligence/11-03-SUMMARY.md`
</output>
