---
phase: 12-inventory-invoice-verification-ml-01-signal-improvements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/e2e/inventory.spec.ts
  - packages/server/src/routes/products.test.ts
  - packages/server/src/routes/products.ts
  - src/pages/Inventory/InventoryView.tsx
  - src/pages/Inventory/ProductDetailDrawer.tsx
autonomous: true
requirements: [QUAL-01]
must_haves:
  truths:
    - "Inventory create/search/status/transaction flows are covered by deterministic automated tests."
    - "Any discovered inventory regressions are fixed in-code and protected by failing-then-passing tests."
    - "Sell flow from inventory remains consistent with invoice creation handoff."
  artifacts:
    - path: "tests/e2e/inventory.spec.ts"
      provides: "Expanded inventory operational E2E matrix"
      contains: "status"
    - path: "packages/server/src/routes/products.test.ts"
      provides: "Route-level validation and edge-case coverage"
      contains: "sell-with-invoice"
  key_links:
    - from: "inventory UI actions"
      to: "products route mutations"
      via: "transaction/status API calls"
      pattern: "/api/products"
---

<objective>
Run a structured inventory verification pass, close discovered defects, and codify coverage for critical status/transaction flows.

Purpose: QUAL-01 requires evidence-backed confidence that day-to-day inventory operations are reliable.
Output: Expanded inventory test matrix plus code fixes where gaps are uncovered.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-inventory-invoice-verification-ml-01-signal-improvements/12-CONTEXT.md
@tests/e2e/inventory.spec.ts
@packages/server/src/routes/products.ts
@packages/server/src/routes/products.test.ts
@src/pages/Inventory/InventoryView.tsx
</context>

<tasks>

<task type="auto" tdd="true">
  <name>Task 1: Expand inventory E2E matrix for operational edge cases</name>
  <files>tests/e2e/inventory.spec.ts</files>
  <action>Add explicit E2E cases for product creation variants, status transitions, transaction history visibility, and invalid input handling in inventory actions.</action>
  <verify>npm run test:e2e -- inventory.spec.ts</verify>
  <done>Inventory E2E suite covers the full operational flow set and reproduces any existing regressions.</done>
</task>

<task type="auto" tdd="true">
  <name>Task 2: Harden products route tests and route validations</name>
  <files>packages/server/src/routes/products.test.ts, packages/server/src/routes/products.ts</files>
  <action>Extend route tests for edge conditions (invalid status transitions, quantity boundaries, malformed sale payloads) and patch route logic if tests expose defects.</action>
  <verify>npm test -- packages/server/src/routes/products.test.ts</verify>
  <done>Products route rejects invalid operations predictably and preserves expected success behavior.</done>
</task>

<task type="auto">
  <name>Task 3: Fix inventory UI regressions uncovered by verification</name>
  <files>src/pages/Inventory/InventoryView.tsx, src/pages/Inventory/ProductDetailDrawer.tsx</files>
  <action>Apply minimal UI fixes required by failed verification scenarios (form validation state, disabled states, transaction display consistency) and keep sidecar parity intact.</action>
  <verify>npm run typecheck</verify>
  <done>Inventory UI behavior aligns with backend validations and all new inventory tests pass.</done>
</task>

</tasks>

<verification>
- [ ] `npm run typecheck`
- [ ] `npm test -- packages/server/src/routes/products.test.ts`
- [ ] `npm run test:e2e -- inventory.spec.ts`
</verification>

<success_criteria>
- Inventory operational flows are verifiably stable.
- Regressions found during audit are fixed and test-protected.
- Sell handoff behavior remains consistent for downstream invoice creation.
</success_criteria>

<output>
After completion, create `.planning/phases/12-inventory-invoice-verification-ml-01-signal-improvements/12-01-SUMMARY.md`
</output>
