---
phase: 12-inventory-invoice-verification-ml-01-signal-improvements
plan: 03
type: execute
wave: 2
depends_on:
  - "12-01"
  - "12-02"
files_modified:
  - packages/shared/src/schemas/pricing.ts
  - packages/shared/src/schemas/savedResearch.ts
  - packages/server/src/services/price-check/PriceCheckService.ts
  - packages/server/src/services/price-check/PriceCheckService.test.ts
  - packages/server/src/services/market-research/MarketResearchService.ts
  - packages/server/src/services/market-research/MarketResearchService.test.ts
  - src/pages/UnifiedIntelligence/UnifiedIntelligenceView.tsx
  - src/pages/MarketResearch/MarketResearchResultPanel.tsx
  - tests/e2e/evaluator.spec.ts
requirements: [ML-01]
autonomous: true
must_haves:
  truths:
    - "Price confidence incorporates evidence quality, source provenance, and freshness weighting."
    - "Trend signals from Phase 11 market-intel snapshots influence guidance outputs."
    - "UI surfaces explain confidence/tendency changes without obscuring operational decisions."
  artifacts:
    - path: "packages/server/src/services/price-check/PriceCheckService.ts"
      provides: "Confidence scoring upgrade with weighted factors"
      contains: "confidenceBreakdown"
    - path: "packages/server/src/services/market-research/MarketResearchService.ts"
      provides: "Trend-aware guidance using cached intelligence signals"
      contains: "trendSignal"
    - path: "src/pages/UnifiedIntelligence/UnifiedIntelligenceView.tsx"
      provides: "Improved confidence and trend signal display"
      contains: "confidence"
  key_links:
    - from: "market-intel snapshot freshness"
      to: "confidence weighting"
      via: "freshness factor"
      pattern: "freshnessWeight"
    - from: "backend confidence diagnostics"
      to: "frontend confidence rendering"
      via: "result diagnostics mapping"
      pattern: "confidenceBreakdown"
---

<objective>
Deliver ML-01 by improving confidence/trend signal quality in pricing and market research guidance using evidence + freshness-aware scoring.

Purpose: Raise trust in AI-guided decisions while preserving transparent uncertainty communication.
Output: Backend confidence/trend scoring upgrades with frontend rendering updates and regression coverage.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-intel-02-agentic-market-intelligence/11-03-SUMMARY.md
@packages/server/src/services/price-check/PriceCheckService.ts
@packages/server/src/services/market-research/MarketResearchService.ts
@src/pages/UnifiedIntelligence/UnifiedIntelligenceView.tsx
@src/pages/MarketResearch/MarketResearchResultPanel.tsx
</context>

<tasks>

<task type="auto" tdd="true">
  <name>Task 1: Add confidence diagnostics and weighted scoring in backend services</name>
  <files>packages/server/src/services/price-check/PriceCheckService.ts, packages/server/src/services/market-research/MarketResearchService.ts, packages/shared/src/schemas/pricing.ts, packages/shared/src/schemas/savedResearch.ts</files>
  <action>Introduce confidence breakdown fields (evidence count, provenance ratio, freshness weight, trend agreement) and update scoring formulas to use weighted factors rather than flat heuristics.</action>
  <verify>npm run typecheck</verify>
  <done>Backend responses include deterministic confidence diagnostics and reflect improved weighting behavior.</done>
</task>

<task type="auto" tdd="true">
  <name>Task 2: Add backend tests for new confidence/trend logic</name>
  <files>packages/server/src/services/price-check/PriceCheckService.test.ts, packages/server/src/services/market-research/MarketResearchService.test.ts</files>
  <action>Add focused tests for confidence weighting branches (high evidence, sparse evidence, stale trend data, conflicting trend data) and verify stable outputs.</action>
  <verify>npm test -- packages/server/src/services/price-check/PriceCheckService.test.ts packages/server/src/services/market-research/MarketResearchService.test.ts</verify>
  <done>Service tests prove confidence/trend behavior and guard against regression of old heuristics.</done>
</task>

<task type="auto">
  <name>Task 3: Render confidence/trend signal improvements in evaluator and market research UI</name>
  <files>src/pages/UnifiedIntelligence/UnifiedIntelligenceView.tsx, src/pages/MarketResearch/MarketResearchResultPanel.tsx, tests/e2e/evaluator.spec.ts</files>
  <action>Update UI to display upgraded confidence/trend context in plain operator language, preserving existing decision workflows and adding regression checks.</action>
  <verify>npm run test:e2e -- evaluator.spec.ts</verify>
  <done>Users can see confidence and trend changes clearly, and evaluator E2E remains green.</done>
</task>

</tasks>

<verification>
- [ ] `npm run typecheck`
- [ ] `npm test -- packages/server/src/services/price-check/PriceCheckService.test.ts packages/server/src/services/market-research/MarketResearchService.test.ts`
- [ ] `npm run test:e2e -- evaluator.spec.ts`
</verification>

<success_criteria>
- Confidence scoring reflects evidence quality and freshness, not only raw comparator count.
- Trend signal from Phase 11 intelligence data materially influences guidance.
- Frontend communicates confidence/trend updates clearly and consistently.
</success_criteria>

<output>
After completion, create `.planning/phases/12-inventory-invoice-verification-ml-01-signal-improvements/12-03-SUMMARY.md`
</output>
